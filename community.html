<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="icon" type="image/jpeg" href="icon.jpg">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セゾン・ド宗像 - オンライン編集対応</title>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>

<style>
  /* --- 基本デザイン --- */
  body { margin:0; font-family:'Segoe UI', sans-serif; background:linear-gradient(to bottom right, #0d0d0d, #1c1c1c); color:white; overflow-x:hidden;}
  h1,h2,h3{margin:0;}
  a{text-decoration:none;color:inherit;}
  /* Hero Section */
  .hero{position:relative;height:100vh;background:url('https://source.unsplash.com/1600x900/?chocolate,artisan') center/cover no-repeat;display:flex;align-items:center;justify-content:center;text-align:center;}
  .hero::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);}
  .hero-content{position:relative;padding:40px;background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);border-radius:16px;animation:fadeIn 1.5s ease;}
  .hero h1{font-size:2.8em;color:#f9f9f9;}
  .hero p{font-size:1.2em;margin-top:10px;color:#e6d8a2;}
  /* Sections */
  section{max-width:1000px;margin:80px auto;padding:0 20px;opacity:0;transform:translateY(30px);animation:slideUp 1.2s ease forwards;}
  section h2{text-align:center;font-size:2em;color:#e6d8a2;margin-bottom:20px;}
  section p{line-height:1.8;text-align:center;}
  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:30px;}
  .card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:12px;padding:20px;text-align:center;transition:transform 0.3s ease, background 0.3s ease;}
  .card:hover{transform:translateY(-6px);background:rgba(255,255,255,0.12);}
  .card h3{color:#e6d8a2;margin-bottom:10px;}
  /* ボタン */
  .btn{display:inline-block;margin-top:20px;padding:12px 30px;background:linear-gradient(90deg,#e6d8a2,#c0a060);color:#0b0b0b;border-radius:8px;font-weight:bold;transition:background 0.3s ease;}
  .btn:hover{background:linear-gradient(90deg,#f4e9b8,#d8b870);}
  /* Footer */
  footer{text-align:center;padding:20px;font-size:14px;background:#111;color:#777;margin-top:60px;}
  /* Animations */
  @keyframes fadeIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
  @keyframes slideUp{to{opacity:1;transform:translateY(0);}}
  /* サインインボタン */
  #signinTrigger{position:fixed;top:15px;right:15px;background:rgba(255,255,255,0.1);color:#f7f7f7;padding:0.4rem 0.8rem;border-radius:8px;font-size:0.9rem;cursor:pointer;transition:all 0.3s;border:1px solid rgba(255,255,255,0.2);z-index:1000;}
  #signinTrigger:hover{background:rgba(0,255,224,0.2);color:#fff;}
  /* 編集ボタン */
  #editBtn{display:none;position:fixed;bottom:20px;right:20px;background:#fafafa;color:#000;padding:0.8rem 1rem;border-radius:50%;cursor:pointer;font-weight:bold;z-index:1000;box-shadow:0 0 15px rgba(0,255,224,0.6);}
  /* モーダル */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000;transition:opacity 0.3s ease;}
  .modal.show{display:flex;}
  #loginBox,#editBox{background:#1c1c1c;padding:2rem;border-radius:12px;box-shadow:0 0 20px rgba(0,255,224,0.3);text-align:center;width:300px;}
  #loginBox h2,#editBox h2{color:#f6f6f6;margin-bottom:1rem;}
  #loginBox input,#editBox textarea{width:100%;padding:0.5rem;margin:0.5rem 0;border:none;border-radius:8px;background:rgba(255,255,255,0.1);color:white;}
  #loginBox button,#editBox button{background:#ffffff;color:#000;padding:0.5rem 1rem;border:none;border-radius:8px;cursor:pointer;margin-top:1rem;width:100%;}
  #editBox textarea{height:150px;margin-bottom:1rem;}
  #editBox button{width:48%;margin:0.5%;}

  @media(max-width:768px){.hero h1{font-size:2em;}}
  #editBtn {
  display: none !important;
}
.sns-links {
  margin-top:20px;
  text-align:center;
}
.sns-links a {
  margin: 0 10px;
  display:inline-block;
  width:36px;
  height:36px;
}
.sns-links img {
  width:100%;
  height:100%;
  filter: invert(1); /* ダーク背景向けに白く */
  transition: transform 0.2s;
}
.sns-links a:hover img {
  transform: scale(1.2);
}
/* 既存の modal クラスを利用 */
#chocoModal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;

  opacity: 0;
  pointer-events: none; /* 非表示時はクリック無効 */
  transition: opacity 0.3s ease;
}

#chocoModal.show {
  opacity: 1;
  pointer-events: all; /* 表示時にクリック有効 */
}
  body { margin:0; font-family:'Segoe UI', sans-serif; background:#1a1a1a; color:white; overflow-x:hidden;}
  h1,h2,h3{margin:0;}
  a{text-decoration:none;color:inherit;}
  section{max-width:800px;margin:40px auto;padding:0 20px;}
  section h2{text-align:center;font-size:1.8em;margin-bottom:20px;}
  section p{line-height:1.6;}
  #signinTrigger{position:fixed;top:15px;right:15px;background:rgba(255,255,255,0.1);color:#fff;padding:0.4rem 0.8rem;border-radius:8px;cursor:pointer;}
  #editBtn{display:none;position:fixed;bottom:20px;right:20px;background:#00ffe0;color:#000;padding:0.8rem 1rem;border-radius:50%;cursor:pointer;font-weight:bold;}
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000;}
  .modal.show{display:flex;}
  #loginBox,#editBox{background:#2a2a2a;padding:2rem;border-radius:12px;text-align:center;width:300px;}
  #loginBox input,#editBox input,#editBox textarea{width:100%;padding:0.5rem;margin:0.5rem 0;border:none;border-radius:8px;background:rgba(255,255,255,0.1);color:white;}
  #loginBox button,#editBox button{width:48%;margin:0.5%;background:#fff;color:#000;padding:0.5rem;border-radius:8px;cursor:pointer;}
  #editBox textarea{height:120px;}
  button.postBtn{margin-top:10px;background:#00ffe0;color:#000;border:none;border-radius:5px;padding:0.3rem 0.5rem;cursor:pointer;}


#infoSections {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.infoCard {
  background: rgba(20, 20, 20, 0.8);
  border: 1px solid rgba(0, 255, 224, 0.3);
  border-radius: 10px;
  padding: 15px 20px;
  position: relative;
  transition: background 0.2s, transform 0.2s;
}

.infoCard:hover {
  background: rgba(0, 255, 224, 0.05);
  transform: translateY(-3px);
}

.infoCard h2 {
  margin: 0 0 8px 0;
  font-size: 1.2em;
  color: #00ffe0;
}

.infoCard p {
  margin: 0;
  line-height: 1.6;
  color: #f0f0f0;
  word-break: break-word;
}

/* 編集・削除ボタン */
.infoCard button.editBtn {
  position: absolute;
  top: 10px;
  right: 50px;
  background: #00ffe0;
  color: #000;
  border: none;
  border-radius: 5px;
  padding: 0.2rem 0.5rem;
  cursor: pointer;
  font-size: 0.9rem;
}

.infoCard button.editBtn:hover {
  background: #00c4b0;
}

.infoCard button.deleteBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #ff4d4d;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0.2rem 0.5rem;
  cursor: pointer;
  font-size: 0.9rem;
}

.infoCard button.deleteBtn:hover {
  background: #e60000;
}





</style>
</head>

<body>
<!-- Hero -->
<div class="hero">
  <div class="hero-content">
    <h1>セゾン・ド・宗像　掲示板</h1>
    <p>話し合おう　適当に</p>
  </div>
</div>

<!-- Products -->





<!-- Story -->
<!-- サインインボタン -->
<button id="signinTrigger">サインイン</button>

<!-- 編集ボタン（固定） -->
<button id="editBtn">✎</button>

<!-- サインインモーダル -->
<div id="loginModal" class="modal">
  <div id="loginBox">
    <h2>サインイン</h2>
    <input type="text" id="username" placeholder="ユーザー名">
    <input type="password" id="password" placeholder="パスワード">
    <button id="loginBtn">ログイン</button>
  </div>
</div>

<!-- 編集モーダル -->
<div id="editModal" class="modal">
  <div id="editBox">
    <h2>投稿編集</h2>
    <input type="text" id="editTitle" placeholder="タイトル">
    <textarea id="editArea"></textarea><br>
    <button id="saveBtn">保存</button>
    <button id="cancelBtn">キャンセル</button>
  </div>
</div>

<!-- 掲示板投稿一覧 -->
<main id="infoSections">
  <!-- JSで投稿を生成 -->
</main>

<div id="signedInMessage" style="display:none; text-align:center; margin-top:20px; color:#00ffe0; font-weight:bold;">
  <p>管理者モードです。投稿・編集・削除が可能。</p>
</div>

<footer style="text-align:center; padding:20px; color:#777;">
  <p>© 2024~2025 オンライン掲示板   Web page Created by watatawa Software</p>
</footer>
<script>
let isSignedIn = false;

const supabaseUrl = "https://zaebyzcghulsofisuqsv.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphZWJ5emNnaHVsc29maXN1cXN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5OTc0OTIsImV4cCI6MjA3MjU3MzQ5Mn0.etTWvg6ngetIO56zYRw00AaP2Y8vvpYG7kkqpEyOt2s";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

const infoSections = document.getElementById("infoSections");
const loginModal = document.getElementById("loginModal");
const editModal = document.getElementById("editModal");
const editBtn = document.getElementById("editBtn");
const signinTrigger = document.getElementById("signinTrigger");
const signedInMessage = document.getElementById("signedInMessage");

let editingId = null;
let infoData = [];

// --- サインインモーダル表示 ---
signinTrigger.addEventListener("click", () => loginModal.classList.add("show"));
loginModal.addEventListener("click", e => { if(e.target === loginModal) loginModal.classList.remove("show"); });

// --- サインイン ---
document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const { data, error } = await supabaseClient.from("user").select("*").eq("username", username).eq("pass", password).single();

  if(data){
    loginModal.classList.remove("show");
    alert("ログイン成功！");
    isSignedIn = true;
    localStorage.setItem("isSignedIn", "true");
    renderSections(true);
    editBtn.style.display = "block";
    signinTrigger.textContent = "サインアウト";
    signedInMessage.style.display = "block";
  } else {
    alert("ユーザー名またはパスワードが間違っています");
    console.error(error);
  }
});

// --- データ読み込み & 描画 ---
async function loadInfoSections() {
  const { data, error } = await supabaseClient.from("community").select("*").order("id", { ascending:true });
  if(error){ console.error(error); infoSections.innerHTML = "<p>読み込みエラー</p>"; return; }

  infoData = data;
  renderSections(isSignedIn);
}

function renderSections(isSignedIn = false){
  infoSections.innerHTML = "";
  
  infoData.forEach(section => {
    const card = document.createElement("div");
    card.className = "infoCard";
    card.innerHTML = `
      <h2>${section.title}</h2>
      <p>${section.content}</p>
      <div class="meta">投稿者: ${section.created_by || "匿名"} | ${new Date(section.created_at).toLocaleString()}</div>
    `;

    if(isSignedIn){
      const editBtn = document.createElement("button");
      editBtn.className = "editBtn";
      editBtn.textContent = "✎";
      editBtn.addEventListener("click", () => openEditor(section.id));
      card.appendChild(editBtn);

      const delBtn = document.createElement("button");
      delBtn.className = "deleteBtn";
      delBtn.textContent = "🗑️";
      delBtn.addEventListener("click", () => deleteSection(section.id));
      card.appendChild(delBtn);
    }

    infoSections.appendChild(card);
  });

  // 新規追加ボタン → サインイン状態に関係なく表示
  const addBtn = document.createElement("button");
  addBtn.textContent = "＋ 新規投稿";
  addBtn.style.display = "block";
  addBtn.style.margin = "30px auto";
  addBtn.style.padding = "0.5rem 1rem";
  addBtn.style.background = "#00ffe0";
  addBtn.style.color = "#000";
  addBtn.style.borderRadius = "8px";
  addBtn.style.cursor = "pointer";
  addBtn.addEventListener("click", () => openEditor(null));
  infoSections.appendChild(addBtn);
}




async function deleteSection(id){
  if(!confirm("本当に削除しますか？")) return;
  const { error } = await supabaseClient.from("community").delete().eq("id", id);
  if(error){ console.error(error); alert("削除失敗"); return; }
  loadInfoSections();
}
// --- 編集モーダル ---
function openEditor(id){
  editingId = id;
  if(id){
    const post = infoData.find(p => p.id == id);
    document.getElementById("editTitle").value = post.title;
    document.getElementById("editArea").value = post.content;
  } else {
    document.getElementById("editTitle").value = "";
    document.getElementById("editArea").value = "";
  }
  editModal.classList.add("show");
}

editBtn.addEventListener("click", () => {
  if(infoData.length === 0) return;
  const lastPost = infoData[infoData.length-1];
  openEditor(lastPost.id);
});

// --- 保存 ---
document.getElementById("saveBtn").addEventListener("click", async () => {
  const newTitle = document.getElementById("editTitle").value.trim();
  const newContent = document.getElementById("editArea").value.trim();
  if(!newTitle || !newContent) return alert("タイトルと内容を入力してください");

  if(editingId){
    const { error } = await supabaseClient.from("community").update({ title:newTitle, content:newContent }).eq("id", editingId);
    if(error){ console.error(error); alert("保存失敗"); return; }
  } else {
    const { error } = await supabaseClient.from("community").insert({ title:newTitle, content:newContent });
    if(error){ console.error(error); alert("追加失敗"); return; }
  }

  editModal.classList.remove("show");
  editingId = null;
  loadInfoSections();
});

// --- キャンセル・モーダル閉じる ---
document.getElementById("cancelBtn").addEventListener("click", ()=>{ editModal.classList.remove("show"); editingId = null; });
editModal.addEventListener("click", e => { if(e.target === editModal) editModal.classList.remove("show"); });

// --- サインイン状態復元 ---
window.addEventListener("DOMContentLoaded", () => {
  if(localStorage.getItem("isSignedIn") === "true"){
    isSignedIn = true;
    editBtn.style.display = "block";
    signinTrigger.textContent = "サインアウト";
    signedInMessage.style.display = "block";
  }
  loadInfoSections();
});

// サインイン／サインアウト切替
signinTrigger.addEventListener("click", () => {
  if(isSignedIn){
    isSignedIn = false;
    localStorage.removeItem("isSignedIn");
    signinTrigger.textContent = "サインイン";
    editBtn.style.display = "none";
    renderSections(false);
    signedInMessage.style.display = "none";
  } else {
    loginModal.classList.add("show");
  }
});
</script>
</body>
</html>
