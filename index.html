<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セゾン・ド宗像 - オンライン編集対応</title>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>

<style>
  /* --- 基本デザイン --- */
  body { margin:0; font-family:'Segoe UI', sans-serif; background:linear-gradient(to bottom right, #0d0d0d, #1c1c1c); color:white; overflow-x:hidden;}
  h1,h2,h3{margin:0;}
  a{text-decoration:none;color:inherit;}
  /* Hero Section */
  .hero{position:relative;height:100vh;background:url('https://source.unsplash.com/1600x900/?chocolate,artisan') center/cover no-repeat;display:flex;align-items:center;justify-content:center;text-align:center;}
  .hero::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);}
  .hero-content{position:relative;padding:40px;background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);border-radius:16px;animation:fadeIn 1.5s ease;}
  .hero h1{font-size:2.8em;color:#f9f9f9;}
  .hero p{font-size:1.2em;margin-top:10px;color:#e6d8a2;}
  /* Sections */
  section{max-width:1000px;margin:80px auto;padding:0 20px;opacity:0;transform:translateY(30px);animation:slideUp 1.2s ease forwards;}
  section h2{text-align:center;font-size:2em;color:#e6d8a2;margin-bottom:20px;}
  section p{line-height:1.8;text-align:center;}
  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:30px;}
  .card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:12px;padding:20px;text-align:center;transition:transform 0.3s ease, background 0.3s ease;}
  .card:hover{transform:translateY(-6px);background:rgba(255,255,255,0.12);}
  .card h3{color:#e6d8a2;margin-bottom:10px;}
  /* ボタン */
  .btn{display:inline-block;margin-top:20px;padding:12px 30px;background:linear-gradient(90deg,#e6d8a2,#c0a060);color:#0b0b0b;border-radius:8px;font-weight:bold;transition:background 0.3s ease;}
  .btn:hover{background:linear-gradient(90deg,#f4e9b8,#d8b870);}
  /* Footer */
  footer{text-align:center;padding:20px;font-size:14px;background:#111;color:#777;margin-top:60px;}
  /* Animations */
  @keyframes fadeIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
  @keyframes slideUp{to{opacity:1;transform:translateY(0);}}
  /* サインインボタン */
  #signinTrigger{position:fixed;top:15px;right:15px;background:rgba(255,255,255,0.1);color:#f7f7f7;padding:0.4rem 0.8rem;border-radius:8px;font-size:0.9rem;cursor:pointer;transition:all 0.3s;border:1px solid rgba(255,255,255,0.2);z-index:1000;}
  #signinTrigger:hover{background:rgba(0,255,224,0.2);color:#fff;}
  /* 編集ボタン */
  #editBtn{display:none;position:fixed;bottom:20px;right:20px;background:#fafafa;color:#000;padding:0.8rem 1rem;border-radius:50%;cursor:pointer;font-weight:bold;z-index:1000;box-shadow:0 0 15px rgba(0,255,224,0.6);}
  /* モーダル */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000;transition:opacity 0.3s ease;}
  .modal.show{display:flex;}
  #loginBox,#editBox{background:#1c1c1c;padding:2rem;border-radius:12px;box-shadow:0 0 20px rgba(0,255,224,0.3);text-align:center;width:300px;}
  #loginBox h2,#editBox h2{color:#f6f6f6;margin-bottom:1rem;}
  #loginBox input,#editBox textarea{width:100%;padding:0.5rem;margin:0.5rem 0;border:none;border-radius:8px;background:rgba(255,255,255,0.1);color:white;}
  #loginBox button,#editBox button{background:#ffffff;color:#000;padding:0.5rem 1rem;border:none;border-radius:8px;cursor:pointer;margin-top:1rem;width:100%;}
  #editBox textarea{height:150px;margin-bottom:1rem;}
  #editBox button{width:48%;margin:0.5%;}

  @media(max-width:768px){.hero h1{font-size:2em;}}
  #editBtn {
  display: none !important;
}
.sns-links {
  margin-top:20px;
  text-align:center;
}
.sns-links a {
  margin: 0 10px;
  display:inline-block;
  width:36px;
  height:36px;
}
.sns-links img {
  width:100%;
  height:100%;
  filter: invert(1); /* ダーク背景向けに白く */
  transition: transform 0.2s;
}
.sns-links a:hover img {
  transform: scale(1.2);
}



</style>
</head>

<body>
<!-- Hero -->
<div class="hero">
  <div class="hero-content">
    <h1>セゾン・ド・宗像</h1>
    <p>自由が丘中学校で生まれた世界で最も先進的なチョコレート</p>
  </div>
</div>

<!-- Products -->
<section>
  <h2>四季を感じるチョコレート</h2>
  <p>自由ヶ丘中学校9年生が考案した、宗像の特産品を使った4種類のチョコレート。<br>地域の魅力をひと粒に込めました。</p>
  <div class="grid">
    <div class="card"><h3>春</h3><p>宗像産ホウレンソウのホワイトチョコ</p></div>
    <div class="card"><h3>夏</h3><p>甘夏 × 大島の塩の爽やかな風味</p></div>
    <div class="card"><h3>秋</h3><p>宗像産イチジクの濃厚な甘み</p></div>
    <div class="card"><h3>冬</h3><p>きなこ × ライスパウダー × 大島の塩</p></div>
  </div>
</section>

<!-- Story -->
<section>
  <h2>プロジェクトストーリー</h2>
  <p>141名の中学生がアイデアを出し合い、投票を経て誕生した「saison de MUNAKATA」。<br>洋菓子専門店「チョコレートショップ」が開発を担当し、宗像市役所でお披露目されました。</p>
</section>


<section>
  <div class="sns-links">
    <a href="https://x.com/munakata2022" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitter.svg" alt="Twitter" />
    </a>
    <a href="https://www.instagram.com/p/DCSyYCtS5Qu/" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram" />
    </a>
    <a href="https://www.facebook.com/munakata.city" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook" />
    </a>
  </div>
</section>


<!-- 追加情報 -->

<!-- サインインボタン -->
<button id="signinTrigger">サインイン</button>

<!-- 編集ボタン -->
<button id="editBtn">✎</button>

<!-- サインインモーダル -->
<div id="loginModal" class="modal">
  <div id="loginBox">
    <h2>サインイン</h2>
       <p>サインイン状態は保存されます</p>
    <input type="text" id="username" placeholder="ユーザー名">
    <input type="password" id="password" placeholder="パスワード">
    <button id="loginBtn">ログイン</button>
  </div>
</div>

<!-- 編集モーダル -->
<main id="infoSections">
  <!-- JSで3つ分生成 -->
</main>

<!-- 編集モーダル -->
<div id="editModal" class="modal">
  <div id="editBox">
    <h2>内容編集</h2>
    <input type="text" id="editTitle" placeholder="タイトル">
    <textarea id="editArea"></textarea><br>
    <button id="saveBtn">保存</button>
    <button id="cancelBtn">キャンセル</button>
 
  </div>
</div>
<div id="signedInMessage" style="display:none; text-align:center; margin-top:20px; color:#00ffe0; font-weight:bold;">
 編集者へ　バグとか動かないとかあったら俺に伝えて
</div>
<!-- サインイン時メッセージ -->

<footer>
    <p>© 2024~2025 セゾン・ド・宗像  　 Web page Created by watatawa Software</p>
</footer>

<script>
   let isSignedIn = false;

const supabaseUrl = "https://zaebyzcghulsofisuqsv.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphZWJ5emNnaHVsc29maXN1cXN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5OTc0OTIsImV4cCI6MjA3MjU3MzQ5Mn0.etTWvg6ngetIO56zYRw00AaP2Y8vvpYG7kkqpEyOt2s";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

const infoSections = document.getElementById("infoSections");
const loginModal = document.getElementById("loginModal");
const editModal = document.getElementById("editModal");
let editingId = null;
let infoData = [];

// --- サインインモーダル表示 ---
document.getElementById("signinTrigger").addEventListener("click", () => loginModal.classList.add("show"));
loginModal.addEventListener("click", e => { if(e.target === loginModal) loginModal.classList.remove("show"); });

// --- サインイン ---
document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const { data, error } = await supabaseClient.from("user").select("*").eq("username", username).eq("pass", password).single();
const signedInMessage = document.getElementById("signedInMessage");
  if(data){
    loginModal.classList.remove("show");
    alert("ログイン成功！");
    isSignedIn = true;
    localStorage.setItem("isSignedIn", "true"); // サインイン状態保持
    renderSections(true);
    editBtn.style.display = "block";
    signinTrigger.textContent = "サインアウト";
      signedInMessage.style.display = "block";
  } else {
    alert("ユーザー名またはパスワードが間違っています");
    console.error(error);
  }
});

// --- データ読み込み & 描画 ---
async function loadInfoSections() {
  const { data, error } = await supabaseClient.from("info").select("*").order("id", { ascending:true });
  if(error){ console.error(error); infoSections.innerHTML = "<p>読み込みエラー</p>"; return; }

  infoData = data;
  renderSections(isSignedIn);
}

function renderSections(isSignedIn = false){
  infoSections.innerHTML = "";

  infoData.forEach(section => {
    const sec = document.createElement("section");
    sec.innerHTML = `
      <h2>${section.title}</h2>
      <p id="infoContent-${section.id}">${section.info}</p>
    `;
   
    infoSections.appendChild(sec);
    if(isSignedIn){
  const btn = document.createElement("button");
  btn.textContent = "✎";
  btn.className = "editBtn";
  btn.dataset.id = section.id;
  btn.style.marginTop = "10px";
  btn.addEventListener("click", () => openEditor(section.id));
  sec.appendChild(btn);

  // 削除ボタン
  const delBtn = document.createElement("button");
  delBtn.textContent = "🗑️";
  delBtn.style.marginLeft = "10px";
  delBtn.style.background = "#ff4d4d";
  delBtn.style.color = "#fff";
  delBtn.style.border = "none";
  delBtn.style.borderRadius = "5px";
  delBtn.style.padding = "0.3rem 0.5rem";
  delBtn.style.cursor = "pointer";
  delBtn.addEventListener("click", () => deleteSection(section.id));
  sec.appendChild(delBtn);
}

  });

  // 新規追加ボタン
  if(isSignedIn){
    const addBtn = document.createElement("button");
    addBtn.textContent = "＋ 新規追加";
    addBtn.style.display = "block";
    addBtn.style.margin = "30px auto";
    addBtn.style.padding = "0.5rem 1rem";
    addBtn.style.background = "#00ffe0";
    addBtn.style.color = "#000";
    addBtn.style.borderRadius = "8px";
    addBtn.style.cursor = "pointer";
    addBtn.addEventListener("click", () => openEditor(null));
    infoSections.appendChild(addBtn);
  }
}
async function deleteSection(id){
  if(!confirm("本当に削除しますか？")) return;

  const { error } = await supabaseClient.from("info").delete().eq("id", id);
  if(error){
    console.error("削除失敗:", error);
    alert("削除に失敗しました");
    return;
  }

  alert("削除しました");
  loadInfoSections(); // 再描画
}


// --- 編集モーダル ---
function openEditor(id){
  editingId = id;
  if(id){
    const section = infoData.find(s => s.id == id);
    document.getElementById("editTitle").value = section.title;
    document.getElementById("editArea").value = section.info;
  } else { // 新規追加
    document.getElementById("editTitle").value = "";
    document.getElementById("editArea").value = "";
  }
  editModal.classList.add("show");
}

editBtn.addEventListener("click", () => {
  if(infoData.length === 0) return;
  const lastSection = infoData[infoData.length-1];
  openEditor(lastSection.id);
});

// --- 保存 ---
document.getElementById("saveBtn").addEventListener("click", async () => {
  const newTitle = document.getElementById("editTitle").value.trim();
  const newContent = document.getElementById("editArea").value.trim();
  if(!newTitle || !newContent) return alert("タイトルと内容を入力してください");

  if(editingId){ // 更新
    const { error } = await supabaseClient.from("info").update({ title:newTitle, info:newContent }).eq("id", editingId);
    if(error){ console.error(error); return alert("保存に失敗しました"); }
  } else { // 新規追加
    const { error } = await supabaseClient.from("info").insert({ title:newTitle, info:newContent });
    if(error){ console.error(error); return alert("追加に失敗しました"); }
  }

  editModal.classList.remove("show");
  editingId = null;
  alert(editingId ? "保存しました" : "追加しました");
  loadInfoSections(); // リロードせずに更新
});

// --- キャンセル・モーダル閉じる ---
document.getElementById("cancelBtn").addEventListener("click", ()=>{ editModal.classList.remove("show"); editingId = null; });
editModal.addEventListener("click", e=>{ if(e.target === editModal) editModal.classList.remove("show"); });

// --- サインイン状態復元 ---
window.addEventListener("DOMContentLoaded", () => {
  const signedIn = localStorage.getItem("isSignedIn");
  if(signedIn === "true"){
    isSignedIn = true;
    editBtn.style.display = "block";
    signinTrigger.textContent = "サインアウト";
    signedInMessage.style.display = "block";
  }
  loadInfoSections();
});

// サインイン／サインアウト切替
signinTrigger.addEventListener("click", () => {
  if(isSignedIn){
    isSignedIn = false;
    localStorage.removeItem("isSignedIn");
    signinTrigger.textContent = "サインイン";
    editBtn.style.display = "none";
    renderSections(false);
    alert("サインアウトしました");
    signedInMessage.style.display = "none";
  } else {
    loginModal.classList.add("show");
  }
});



</script>
</body>
</html>
