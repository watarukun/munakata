<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>セゾン・ド・宗像</title>
<link rel="icon" type="image/jpeg" href="icon.jpg">

 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>

<style>
    
    .chart-container {
  margin-bottom: 30px;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #f9f9f9;
  text-align: center;
}

.chart-container canvas {
  max-width: 300px;
  margin: auto;
}

.form-group {
  margin-bottom: 10px;
}

  /* --- 基本デザイン --- */
  body { margin:0; font-family:'Segoe UI', sans-serif; background:linear-gradient(to bottom right, #0d0d0d, #1c1c1c); color:white; overflow-x:hidden;}
  h1,h2,h3{margin:0;}
  a{text-decoration:none;color:inherit;}
  /* Hero Section */
  .hero {
  position: relative;
  height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

/* スライドショー */
.hero .slides-wrapper {
  display: flex;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0; left: 0;
  transition: transform 0.5s ease;
}

.hero .slides-wrapper img {
  flex-shrink: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* オーバーレイ */
.hero-overlay {
  content: '';
  position: absolute;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.6);
}

/* コンテンツ */
.hero-content {
  position: relative;
  padding: 40px;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 16px;
  animation: fadeIn 1.5s ease;
}

.hero h1 {
  font-size: 2.8em;
  color: #f9f9f9;
}

.hero p {
  font-size: 1.2em;
  margin-top: 10px;
  color: #e6d8a2;
}

/* フェードインアニメーション */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
 /* Sections */
  section{max-width:1000px;margin:80px auto;padding:0 20px;opacity:0;transform:translateY(30px);animation:slideUp 1.2s ease forwards;}
  section h2{text-align:center;font-size:2em;color:#e6d8a2;margin-bottom:20px;}
  section p{line-height:1.8;text-align:center;}
  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:30px;}
  .card{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);border-radius:12px;padding:20px;text-align:center;transition:transform 0.3s ease, background 0.3s ease;}
  .card:hover{transform:translateY(-6px);background:rgba(255,255,255,0.12);}
  .card h3{color:#e6d8a2;margin-bottom:10px;}
  /* ボタン */
  .btn{display:inline-block;margin-top:20px;padding:12px 30px;background:linear-gradient(90deg,#e6d8a2,#c0a060);color:#0b0b0b;border-radius:8px;font-weight:bold;transition:background 0.3s ease;}
  .btn:hover{background:linear-gradient(90deg,#f4e9b8,#d8b870);}
  /* Footer */
  footer{text-align:center;padding:20px;font-size:14px;background:#111;color:#777;margin-top:60px;}
  /* Animations */
  @keyframes fadeIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
  @keyframes slideUp{to{opacity:1;transform:translateY(0);}}
  /* サインインボタン */
  #signinTrigger{background:rgba(49, 49, 49, 0.1);color:#a5a5a5;padding:0.4rem 0.8rem;border-radius:1px;font-size:0.9rem;cursor:pointer;transition:all 0.3s;border:1px solid rgba(255, 255, 255, 0);z-index:1000;}
  #signinTrigger:hover{background:rgba(255, 255, 255, 0.2);color:#fff;}
  /* 編集ボタン */
  #editBtn{display:none;position:fixed;bottom:20px;right:20px;background:#fafafa;color:#000;padding:0.8rem 1rem;border-radius:50%;cursor:pointer;font-weight:bold;z-index:1000;}
  /* モーダル */
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:2000;transition:opacity 0.3s ease;}
  .modal.show{display:flex;}
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

/* モーダル表示時 */
.modal.show {
  opacity: 1;
  pointer-events: all;
}

/* ボックス本体 */
#loginBox {
  background: #1c1c1c;
  padding: 2rem;
  border-radius: 3px;

  text-align: center;
  width: 300px;
  transform: scale(0.8);
  opacity: 0;
  animation: popIn 0.4s ease forwards;
}

/* 見出し */
#loginBox h2 {
  color: #f6f6f6;
  margin-bottom: 1rem;
  font-weight: 600;
  letter-spacing: 1px;
}

/* 入力欄 */
#loginBox input {
  width: 100%;
  padding: 0.6rem;
  margin: 0.5rem 0;
  border: none;
  border-radius: 0px;
  background: rgba(255,255,255,0.08);
  color: white;
  font-size: 0.9rem;
  transition: 0.3s;
}

#loginBox input:focus {
  outline: none;
  background: rgba(234, 234, 234, 0.15);

}

/* ボタン */
#loginBox button {
  background: linear-gradient(90deg, #ffffff, #ffffff);
  color: #000;
  padding: 0.6rem 1rem;
  border: none;
  border-radius: 1px;
  cursor: pointer;
  margin-top: 1rem;
  width: 106%;
  font-weight: bold;
  font-size: 1rem;
  transition: 0.3s;
}

#loginBox button:hover {
  background: linear-gradient(90deg, #c6c6c6, #ffffff);

  transform: translateY(-2px);
}

/* アニメーション */
@keyframes popIn {
  from {
    transform: scale(0.8) translateY(-20px);
    opacity: 0;
  }
  to {
    transform: scale(1) translateY(0);
    opacity: 1;
  }
}

  @media(max-width:768px){.hero h1{font-size:2em;}}
  #editBtn {
  display: none !important;
}
.sns-links {
  margin-top:20px;
  text-align:center;
}
.sns-links a {
  margin: 0 10px;
  display:inline-block;
  width:36px;
  height:36px;
}
.sns-links img {
  width:100%;
  height:100%;
  filter: invert(1); /* ダーク背景向けに白く */
  transition: transform 0.2s;
}
.sns-links a:hover img {
  transform: scale(1.2);
}
/* 既存の modal クラスを利用 */
#chocoModal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3000;

  opacity: 0;
  pointer-events: none; /* 非表示時はクリック無効 */
  transition: opacity 0.3s ease;
}

#chocoModal.show {
  opacity: 1;
  pointer-events: all; /* 表示時にクリック有効 */
}

  


/* ===== 円グラフ入力欄 ===== */
.pie-data-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 15px;
}

.form-group {
  display: flex;
  gap: 15px;
  align-items: center;
}

.form-group label {
  font-size: 14px;
  font-weight: bold;
}

.form-group input[type="text"],
.form-group input[type="number"] {
  padding: 6px 8px;
  border: 1px solid #ccc;
  border-radius: 6px;
  width: 120px;
}

/* ===== ボタン ===== */
#pieChartSection button {
  margin-right: 10px;
  padding: 8px 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.btn-add {
  background-color: #00c3ff;
  color: white;
}

.btn-add:hover {
  background-color: #009ace;
}

.btn-generate {
  background-color: #4caf50;
  color: white;
}

.btn-generate:hover {
  background-color: #3a8f40;
}

/* ===== 円グラフ表示領域 ===== */
.chart-container {
  margin-bottom: 30px;
  padding: 15px;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #f9f9f9;
  text-align: center;
}

.chart-container canvas {
  max-width: 320px;
  margin: auto;
}

#slideshow .slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

#slideshow .slide.active {
  opacity: 1;
  z-index: 1;
}



</style>
</head>

<body>
<!-- Hero -->
<div class="hero">
  <div class="slides-wrapper">

    <img src="img2.png" alt="">
    <img src="img3.png" alt="">
    <img src="img4.png" alt="">
    <img src="img5.png" alt="">

  </div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1>セゾン・ド・宗像</h1>
    <p>自由ヶ丘中学校で生まれた世界で最も先進的なチョコレート</p>
  </div>
</div>


<!-- Products -->
<section>
  <h2>四季を感じるチョコレート</h2>
  <p>自由ヶ丘中学校9年生が考案した、宗像の特産品を使った4種類のチョコレート。<br>地域の魅力をひと粒に込めました。</p>
  <div class="grid">
    <div class="card"><h3>春</h3><p>宗像産ホウレンソウのホワイトチョコ</p></div>
    <div class="card"><h3>夏</h3><p>甘夏 × 大島の塩の爽やかな風味</p></div>
    <div class="card"><h3>秋</h3><p>宗像産イチジクの濃厚な甘み</p></div>
    <div class="card"><h3>冬</h3><p>きなこ × ライスパウダー × 大島の塩</p></div>
  </div>
</section>
<div id="chocoModal" class="modal">
  <div id="chocoBox" style="background:#1c1c1c; padding:2rem; border-radius:12px; width:400px; text-align:center; position:relative;">
    <span id="closeModal" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:1.5rem;">&times;</span>
    <h2 id="chocoTitle"></h2>
    <p id="chocoDesc"></p>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const chocoModal = document.getElementById('chocoModal');
  const chocoTitle = document.getElementById('chocoTitle');
  const chocoDesc = document.getElementById('chocoDesc');
  const closeModal = document.getElementById('closeModal');

  const chocoData = {
    "春": { title: "春", desc: "宗像産ホウレンソウのホワイトチョコ" },
    "夏": { title: "夏", desc: "甘夏 × 大島の塩の爽やかな風味" },
    "秋": { title: "秋", desc: "宗像産イチジクの濃厚な甘み" },
    "冬": { title: "冬", desc: "きなこ × ライスパウダー × 大島の塩" }
  };

  document.querySelectorAll('.grid .card').forEach(card => {
    card.addEventListener('click', () => {
      const key = card.querySelector('h3').textContent;
      if(chocoData[key]){
        chocoTitle.textContent = chocoData[key].title;
        chocoDesc.textContent = chocoData[key].desc;
        chocoModal.classList.add('show');
      }
    });
  });

  closeModal.addEventListener('click', () => {
    chocoModal.classList.remove('show');
  });

  chocoModal.addEventListener('click', e => {
    if(e.target === chocoModal) chocoModal.classList.remove('show');
  });
});
</script>


<!-- Story -->
<section>
  <h2>プロジェクトストーリー</h2>
  <p>141名の中学生がアイデアを出し合い、投票を経て誕生した「saison de MUNAKATA」。<br>洋菓子専門店「チョコレートショップ」が開発を担当し、宗像市役所でお披露目されました。</p>
</section>


<section>
  <div class="sns-links">
    <a href="https://x.com/munakata2022" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitter.svg" alt="Twitter" />
    </a>
    <a href="https://www.instagram.com/p/DCSyYCtS5Qu/" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram" />
    </a>
    <a href="https://www.facebook.com/munakata.city" target="_blank">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook" />
    </a>
  </div>
</section>

<section class="boardSection">
  <h2>お知らせ・最新情報</h2>
  <a href="community.html" class="boardCard">
    <p>新着お知らせ</p>
  </a>
</section>

<style>
.boardSection {
  max-width: 600px;
  margin: 50px auto;
  text-align: center;
}

.boardSection h2 {
  font-size: 2em;
  color: #e6d8a2;
  margin-bottom: 20px;
}

.boardCard {
  display: block;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 12px;
  padding: 30px;
  color: #fff;
  font-size: 1.2em;
  text-decoration: none;
  transition: transform 0.3s ease, background 0.3s ease;
}

.boardCard:hover {
  transform: translateY(-6px);
  background: rgba(255,255,255,0.12);
  box-shadow: 0 8px 20px rgba(0,255,224,0.4);
}

.boardCard p {
  margin: 0;
  font-weight: bold;
}
</style>


<!-- 追加情報 -->

<!-- サインインボタン -->


<!-- 編集ボタン -->
<button id="editBtn">✎</button>


<!-- サインインモーダル -->
<div id="loginModal" class="modal">
  <div id="loginBox">
    <h2>編集者用サインイン</h2>
       <p>サインイン状態は維持されます</p>
    <input type="text" id="username" placeholder="ユーザー名">
    <input type="password" id="password" placeholder="パスワード">
    <button id="loginBtn">ログイン</button>
  </div>
</div>
<!-- 管理者メモモーダル -->
<!-- 管理者メモモーダル -->
<div id="adminNoteModal" style="
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width:80%;
  max-width:600px;
  background: rgba(30,30,30,0.9);
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  backdrop-filter: blur(10px);
  z-index: 9999;
  flex-direction: column;
  animation: fadeInModal 0.3s ease forwards;
">

  <h3 style="color:#ffffff; text-align:center; margin-bottom:8px; font-size:1.8em;">メモ</h3>
  <h4 style="color:#cccccc; text-align:center; margin-bottom:15px; font-weight:400;">このメモの内容は他の編集者と共有されます</h4>
  
  <textarea id="adminNoteTextarea" style="
    width:100%;
    height:400px;
    padding:10px;
    border-radius:12px;
    border:none;
    background: rgba(255,255,255,0.05);
    color: #ffffff;
    font-family: Consolas, monospace;
    font-size:14px;
    resize: vertical;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
  "></textarea>

  <div style="margin-top:15px; text-align:right;">
    <button onclick="closeAdminNote()" style="
      padding:8px 15px;
      margin-right:8px;
      border:none;
      border-radius:10px;
      background: #444;
      color:#fff;
      cursor:pointer;
      transition: 0.3s;
    " onmouseover="this.style.background='#666'" onmouseout="this.style.background='#444'">閉じる</button>

    <button id="saveNoteBtn" style="
      padding:8px 15px;
      border:none;
      border-radius:10px;
      background: linear-gradient(90deg,#ffffff,#ffffff);
      color:#0b0b0b;
      cursor:pointer;
      font-weight:bold;
      transition: 0.3s;
    " onmouseover="this.style.background='linear-gradient(90deg,)'" onmouseout="this.style.background='linear-gradient(90deg,)'">保存</button>
  </div>
</div>


<button id="opensubeditmodal" style="
  display:none;
  position:fixed;
  bottom:120px;
  right:20px;
  padding:32px 10px;
  border:none;
  border-radius:50%;
  background: linear-gradient(135deg,#2a9bc7);
  color:#ffffff;
  font-weight:bold;
  cursor:pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  transition: 0.3s;
  z-index: 99;
  
" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">新規作成＋</button>


<!-- 管理者メモを開くボタン -->
<button id="openAdminBtn" style="
  display:none;
  position:fixed;
  bottom:20px;
  right:20px;
  padding:32px 10px;
  border:none;
  border-radius:50%;
  background: linear-gradient(135deg,#fffd84);
  color:#373737;
  font-weight:bold;
  cursor:pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  transition: 0.3s;
" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">管理者メモ</button>

<style>
@keyframes fadeInModal {
  from { opacity:0; transform: translate(-50%, -45%); }
  to { opacity:1; transform: translate(-50%, -50%); }
}
</style>



<!-- 管理者メモを開くボタン -->



<!-- 編集モーダル -->
<main id="infoSections">
  <!-- JSで3つ分生成 -->
</main>

<!-- 編集モーダル -->
<div id="editModal" class="modal">
  <div id="editBox">
    <h2>内容編集</h2>
    <input type="text" id="editTitle" placeholder="タイトル">
    <textarea id="editArea"></textarea><br>
    <button id="saveBtn">保存</button>
    <button id="cancelBtn">キャンセル</button>
 
  </div>
</div>


<!-- ======= 円グラフ付き情報追加・編集モーダル ======= -->
<!-- 円グラフ付き情報追加・編集モーダル -->
<div id="editorModal" style="
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#262626;   /* ← ここを変更 */
    padding:20px;
    border-radius:3px;
border: 4px solid #2c2c2c;
    z-index:9999;
    max-width:400px;
    width:90%;
">
  <h3>情報を編集</h3><p>URLは自動的にリンク化されます</p>
  <input id="editorTitle" type="text" placeholder="タイトル" style="width:100%; margin-bottom:10px; padding:5px;" />
  <textarea id="editorInfo" placeholder="説明" style="width:100%; height:80px; margin-bottom:10px; padding:5px;"></textarea>

  <h4>円グラフデータ</h4><p>追加しない場合は空白でok</p>
  <div id="chartInputs"></div>
  <button type="button" onclick="addChartInputRow(document.getElementById('chartInputs'))" style="margin-top:5px;">＋ グラフデータ追加</button>

  <div style="margin-top:15px; text-align:right;">
    <button onclick="saveSection()" style="padding:5px 10px; background:#ffdf77; border:none; border-radius:1px; cursor:pointer;">保存</button>
    <button onclick="closeEditor()" style="padding:5px 10px; margin-left:10px;">キャンセル</button>
  </div>
</div>



<!-- グラフ表示領域 -->
<div id="output" style="margin-top:30px;"></div>
<div id="signedInMessage" style="display:none; text-align:center; margin-top:20px; color:#00ffe0; font-weight:bold;">
<p> 編集者へ、バグとか動かないとかあったら伝えて</p>
<p>ふざけた内容の追加は許しません。変更内容は即座に反映されます</p>
</div>
<br>
<hr style="border: 1px solid #2c2c2c;">

<div id="toukei" style="text-align: center; display: none;">
<section>
  <h2 style="color: #929292;">閲覧者数統計</h2>
  <p id="visitorCount-1"></p> <!-- 閲覧者数専用ID -->
</section>
<hr style="border: 1px solid #262626;">
<section>
   <h2 style="color: rgb(255, 255, 255);">作業用BGM</h2>
<audio id="myAudio" src="yeeeeeeee.mp3" preload="auto"></audio>
<button onclick="playAudio()" style="background-color: #ffffff; border-radius: 5px;">再生</button>
<button onclick="pauseAudio()" style="background-color: rgb(110, 110, 110); border-radius: 5px;">停止</button>
</section>
<hr style="border: 1px solid #212121;">
<section>
  <h2>画像の追加について</h2>
  <p>技術的に不可能でした　諦めてください</p>
<p>どうしても追加したい場合は原始的にHTMLに直接埋め込みます</p>
</section>
<script>
  const audio = document.getElementById('myAudio');
  function playAudio() { audio.play(); }
  function pauseAudio() { audio.pause(); }
</script>
<hr style="border: 1px solid #212121;">
<section>
  <h2 style="color: rgb(215, 181, 157);">癒し</h2>
<div id="myVideoWrapper" class="youtube-video-wrapper" style="display:none;">
  <video id="myVideo" src="guff.mp4"></video>
  <div class="controls">
    <button id="playBtn">▶</button>
    <span id="currentTime">0:00</span>
    <input type="range" id="progress" value="0" min="0" max="100">
    <span id="duration">0:00</span>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
  </div>
</div>

<button style="background-color: #ffffff; border-radius: 5px;" id="guff">癒される</button>


<style>
.youtube-video-wrapper {
  max-width: 600px; /* 最大幅を変更 */
  width: 90%;        /* ページ幅に対する割合 */
  height: auto;      /* 高さは自動調整（縦横比維持） */
  margin: 20px auto;
  background: #000;
  border-radius: 6px;
  overflow: hidden;
  position: relative;
 display: none;
  cursor: pointer;
}

/* 動画本体 */
.youtube-video-wrapper video {
  width: 100%;
  height: auto; /* ここで縦横比を維持 */
  display: block;
}


/* コントロールバー */
.youtube-video-wrapper .controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px 8px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

/* hoverで表示 */
.youtube-video-wrapper:hover .controls {
  opacity: 1;
}

/* ボタン */
.youtube-video-wrapper .controls button {
  border: none;
  background: none;
  color: #fff;
  font-size: 1.1rem;
  cursor: pointer;
}
.youtube-video-wrapper .controls input[type="range"]#progress {
  flex: 1;           /* ← これで横いっぱいに広がる */
  margin: 0 5px;     /* ボタンと時間表示との間隔 */
}


/* プログレスバー */
.youtube-video-wrapper .controls input[type="range"] {
  cursor: pointer;
  appearance: none;
  height: 5px;
  background: #555;
  border-radius: 2px;
  transition: all 0.2s;
}

/* プログレスバーつまみ */
#progress::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  background: #fff;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.2s;
}
#progress::-webkit-slider-thumb:hover {
  transform: scale(1.3);
}

/* 音量バー */
#volume {
  width: 80px;
}

/* 時間表示 */
.youtube-video-wrapper .controls span {
  color: #fff;
  font-size: 0.85rem;
  width: 40px;
  text-align: center;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 動画表示ボタン
  const guffBtn = document.getElementById('guff');
const myVideoWrapper = document.getElementById('myVideoWrapper');


guffBtn.addEventListener('click', () => {
  myVideoWrapper.style.display = 'block';
    guffBtn.style.display = 'none';
  const video = document.getElementById('myVideo');
 
});


  // 動画操作
  const video = document.getElementById('myVideo');
  const playBtn = document.getElementById('playBtn');
  const progress = document.getElementById('progress');
  const currentTime = document.getElementById('currentTime');
  const duration = document.getElementById('duration');
  const volume = document.getElementById('volume');

  function formatTime(sec){
    const m = Math.floor(sec / 60);
    const s = Math.floor(sec % 60);
    return `${m}:${s.toString().padStart(2,'0')}`;
  }

  // 再生・停止
  playBtn.addEventListener('click', () => {
    if(video.paused) video.play();
    else video.pause();
  });

  // 動画の進捗と時間表示
  video.addEventListener('timeupdate', () => {
    if(video.duration) progress.value = (video.currentTime / video.duration) * 100;
    currentTime.textContent = formatTime(video.currentTime);
  });

  // 総時間
  video.addEventListener('loadedmetadata', () => {
    duration.textContent = formatTime(video.duration);
  });

  // バー操作で動画位置変更
  progress.addEventListener('input', () => {
    video.currentTime = (progress.value / 100) * video.duration;
  });

  // 音量操作
  volume.addEventListener('input', () => {
    video.volume = volume.value;
  });

  // 再生状態でボタン表示切替
  video.addEventListener('play', () => playBtn.textContent = 'ガフを止める');
  video.addEventListener('pause', () => playBtn.textContent = 'ガフを躍らす');
});
</script>

</div>

<!-- サインイン時メッセージ -->

<footer>
    <p>© 2024~2025 セゾン・ド・宗像  　 Web page Created by watatawa Software　　　　　　<button id="signinTrigger">編集者サインイン</button></p>
</footer>

<script>
   let isSignedIn = false;

const supabaseUrl = "https://zaebyzcghulsofisuqsv.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphZWJ5emNnaHVsc29maXN1cXN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5OTc0OTIsImV4cCI6MjA3MjU3MzQ5Mn0.etTWvg6ngetIO56zYRw00AaP2Y8vvpYG7kkqpEyOt2s";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

const infoSections = document.getElementById("infoSections");
const loginModal = document.getElementById("loginModal");
const editModal = document.getElementById("editModal");
const opensubeditmodal = document.getElementById("opensubeditmodal");
let editingId = null;
let infoData = [];

// --- サインインモーダル表示 ---
document.getElementById("signinTrigger").addEventListener("click", () => loginModal.classList.add("show"));
loginModal.addEventListener("click", e => { if(e.target === loginModal) loginModal.classList.remove("show"); });

// --- サインイン ---
document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const { data, error } = await supabaseClient.from("user").select("*").eq("username", username).eq("pass", password).single();
const signedInMessage = document.getElementById("signedInMessage");
  if(data){
    loginModal.classList.remove("show");
    alert("ログイン成功！");
    isSignedIn = true;
    localStorage.setItem("isSignedIn", "true"); // サインイン状態保持
    renderSections(true);
    editBtn.style.display = "block";
     toukei.style.display = "block";
      opensubeditmodal.style.display = "block";
    signinTrigger.textContent = "サインアウト";
        openAdminBtn.style.display ='block';
      signedInMessage.style.display = "block";
  } else {
    alert("ユーザー名またはパスワードが間違っています");
    console.error(error);
  }
});

// --- データ読み込み & 描画 ---
async function loadInfoSections() {
  const { data, error } = await supabaseClient
    .from("info")
    .select("*")
    .order("id", { ascending: true });

  if (error) {
    console.error(error);
    infoSections.innerHTML = "<p>読み込みエラー</p>";
    return;
  }

  infoData = data;
  renderSections(isSignedIn);
}

// --- URL自動リンク化 ---
function renderInfoText(text) {
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  // aタグ内の style で色を指定
  return text.replace(urlRegex, '<a href="$1" target="_blank" style="color: white; font-weight: bold ">$1</a>');
}


function renderSections(isSignedIn = false) {
  infoSections.innerHTML = "";

  infoData.forEach(section => {
    const sec = document.createElement("section");

    // info部分を自動リンク化して埋め込み
    const linkedInfo = renderInfoText(section.info || "");

    sec.innerHTML = `
      <h2>${section.title}</h2>
      <p id="infoContent-${section.id}" style="color">${linkedInfo}</p>
    `;
    infoSections.appendChild(sec);

    // --- 編集ボタンと削除ボタン ---
    if (isSignedIn) {
      const btn = document.createElement("button");
      btn.textContent = "✎編集";
      btn.className = "editBtn";
      btn.dataset.id = section.id;
      btn.style.marginTop = "10px";
      btn.addEventListener("click", () => openEditor(section.id));
      sec.appendChild(btn);

      const delBtn = document.createElement("button");
      delBtn.textContent = "削除";
      delBtn.style.marginLeft = "10px";
      delBtn.style.background = "#ff4d4d";
      delBtn.style.color = "#fff";
      delBtn.style.border = "none";
      delBtn.style.borderRadius = "5px";
      delBtn.style.padding = "0.3rem 0.5rem";
      delBtn.style.cursor = "pointer";
      delBtn.addEventListener("click", () => deleteSection(section.id));
      sec.appendChild(delBtn);
    }

    // --- 円グラフ描画 ---
    if (section.chart_data && Array.isArray(section.chart_data) && section.chart_data.length > 0) {
      const chartContainer = document.createElement("div");
      chartContainer.className = "chart-container";

      // 中央配置用スタイル
      chartContainer.style.width = "300px";
      chartContainer.style.height = "300px";
      chartContainer.style.display = "flex";
      chartContainer.style.justifyContent = "center";
      chartContainer.style.alignItems = "center";
      chartContainer.style.margin = "0 auto";

      const canvas = document.createElement("canvas");
      chartContainer.appendChild(canvas);
      sec.appendChild(chartContainer);

      const labels = section.chart_data.map(item => item.label);
      const values = section.chart_data.map(item => item.value);

      new Chart(canvas, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: [
              'rgba(255, 99, 132, 0.6)',
              'rgba(54, 162, 235, 0.6)',
              'rgba(255, 206, 86, 0.6)',
              'rgba(75, 192, 192, 0.6)',
              'rgba(153, 102, 255, 0.6)',
              'rgba(255, 159, 64, 0.6)'
            ]
          }]
        },
        options: {
          responsive: false,
          maintainAspectRatio: true,
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }
  });

  // --- 新規追加ボタン ---
// --- renderSections 内の isSignedIn チェック部分に置くコード ---
if (isSignedIn) {
  // 既存の「＋ 新規追加」ボタン（動的生成）
  const addBtn = document.createElement("button");
  addBtn.textContent = "＋ 新規追加";
  addBtn.style.display = "block";
  addBtn.style.margin = "30px auto";
  addBtn.style.padding = "0.5rem 1rem";
  addBtn.style.background = "#00ffe0";
  addBtn.style.color = "#000";
  addBtn.style.borderRadius = "8px";
  addBtn.style.cursor = "pointer";
  addBtn.addEventListener("click", () => openEditor(null));
  infoSections.appendChild(addBtn);

  // HTML に既にある opensubeditmodal ボタンを取得して安全に使う
  const opensubeditmodalBtn = document.getElementById("opensubeditmodal");
  if (opensubeditmodalBtn) {
    // 二重バインド防止フラグをチェックしてからイベント登録
    if (!opensubeditmodalBtn.dataset.bound) {
      opensubeditmodalBtn.addEventListener("click", () => openEditor(null));
      opensubeditmodalBtn.dataset.bound = "1";
    }
    // サインイン時のみ表示（サインアウト時は別で非表示に戻してください）
    opensubeditmodalBtn.style.display = "block";
  }
} else {
  // サインアウト時は既存ボタンを非表示に
  const opensubeditmodalBtn = document.getElementById("opensubeditmodal");
  if (opensubeditmodalBtn) opensubeditmodalBtn.style.display = "none";
}
}


async function deleteSection(id) {
  if (!confirm("本当に削除しますか？")) return;

  const { error } = await supabaseClient.from("info").delete().eq("id", id);
  if (error) {
    console.error("削除失敗:", error);
    alert("削除に失敗しました");
    return;
  }

  alert("削除しました");
  loadInfoSections();
}

// --- 編集モーダル ---
function openEditor(sectionId = null) {
  const modal = document.getElementById("editorModal");
  const titleInput = document.getElementById("editorTitle");
  const infoInput = document.getElementById("editorInfo");
  const chartArea = document.getElementById("chartInputs");

  editingId = sectionId;

  titleInput.value = "";
  infoInput.value = "";
  chartArea.innerHTML = "";

  if (sectionId) {
    const section = infoData.find(s => s.id === sectionId);
    if (section) {
      titleInput.value = section.title;
      infoInput.value = section.info;
      if (section.chart_data && Array.isArray(section.chart_data)) {
        section.chart_data.forEach(item => addChartInputRow(chartArea, item.label, item.value));
      }
    }
  } else {
    addChartInputRow(chartArea);
  }

  modal.style.display = "block";
}

function closeEditorModal() {
  document.getElementById("editorModal").style.display = "none";
  editingId = null;
}




editBtn.addEventListener("click", () => {
  if(infoData.length === 0) return;
  const lastSection = infoData[infoData.length-1];
  openEditor(lastSection.id);
});

// --- 保存 ---
document.getElementById("saveBtn").addEventListener("click", async () => {
  const newTitle = document.getElementById("editTitle").value.trim();
  const newContent = document.getElementById("editArea").value.trim();
  if(!newTitle || !newContent) return alert("タイトルと内容を入力してください");

  if(editingId){ // 更新
    const { error } = await supabaseClient.from("info").update({ title:newTitle, info:newContent }).eq("id", editingId);
    if(error){ console.error(error); return alert("保存に失敗しました"); }
  } else { // 新規追加
    const { error } = await supabaseClient.from("info").insert({ title:newTitle, info:newContent });
    if(error){ console.error(error); return alert("追加に失敗しました"); }
  }

  editModal.classList.remove("show");
  editingId = null;
  alert(editingId ? "保存しました" : "追加しました");
  loadInfoSections(); // リロードせずに更新
});

// --- キャンセル・モーダル閉じる ---
document.getElementById("cancelBtn").addEventListener("click", ()=>{ editModal.classList.remove("show"); editingId = null; });
editModal.addEventListener("click", e=>{ if(e.target === editModal) editModal.classList.remove("show"); });

// --- サインイン状態復元 ---
window.addEventListener("DOMContentLoaded", () => {
  const signedIn = localStorage.getItem("isSignedIn");
  if(signedIn === "true"){
    isSignedIn = true;
    editBtn.style.display = "block";
    signinTrigger.textContent = "サインアウト";
    signedInMessage.style.display = "block";
        opensubeditmodal.style.display = "block";

  }
  loadInfoSections();
});

// サインイン／サインアウト切替
signinTrigger.addEventListener("click", () => {
  if(isSignedIn){
    isSignedIn = false;
    localStorage.removeItem("isSignedIn");
    signinTrigger.textContent = "サインイン";
    openAdminBtn.style.display ='none';
    editBtn.style.display = "none";
        toukei.style.display = "none";
             opensubeditmodal.style.display = "none";
    renderSections(false);
    alert("サインアウトしました");
    signedInMessage.style.display = "none";
  } else {
    loginModal.classList.add("show");
  }
});

function addChartInputRow(container, label = "", value = "") {
  const row = document.createElement("div");
  row.className = "chart-input-row";
  row.style.display = "flex";
  row.style.gap = "10px";
  row.style.marginBottom = "5px";

  row.innerHTML = `
    <input type="text" placeholder="ラベル" value="${label}" class="chart-label-input" style="flex:1; padding:5px;" />
    <input type="number" placeholder="値" value="${value}" class="chart-value-input" style="width:80px; padding:5px;" />
    <button type="button" class="remove-row-btn" style="background:#ff4d4d; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer;">✖</button>
  `;

  row.querySelector(".remove-row-btn").addEventListener("click", () => {
    container.removeChild(row);
  });

  container.appendChild(row);
}


// --- 保存 ---
// editorModal の保存ボタンを押した時の処理
async function saveSection() {
  const titleInput = document.getElementById("editorTitle");
  const infoInput = document.getElementById("editorInfo");
  const chartArea = document.getElementById("chartInputs");

  const newTitle = titleInput.value.trim();
  const newInfo = infoInput.value.trim();

  if (!newTitle || !newInfo) return alert("タイトルと内容を入力してください");

  // チャートデータ取得
  const chartData = Array.from(chartArea.querySelectorAll(".chart-input-row")).map(row => {
    const label = row.querySelector(".chart-label-input").value.trim();
    const value = parseFloat(row.querySelector(".chart-value-input").value);
    return { label, value };
  }).filter(item => item.label && !isNaN(item.value));

  if (editingId) {
    // 更新
    const { error } = await supabaseClient
      .from("info")
      .update({ title: newTitle, info: newInfo, chart_data: chartData })
      .eq("id", editingId);
    if (error) { console.error(error); return alert("保存に失敗しました"); }
    alert("保存しました");
  } else {
    // 新規追加
    const { error } = await supabaseClient
      .from("info")
      .insert({ title: newTitle, info: newInfo, chart_data: chartData });
    if (error) { console.error(error); return alert("追加に失敗しました"); }
    alert("追加しました");
  }

  closeEditorModal();
  editingId = null;
  loadInfoSections(); // 再描画
}

function closeEditor() {
  document.getElementById("editorModal").style.display = "none";
  editingId = null;
}







const adminNoteModal = document.getElementById('adminNoteModal');
const adminNoteTextarea = document.getElementById('adminNoteTextarea');
const saveNoteBtn = document.getElementById('saveNoteBtn');
const openAdminBtn = document.getElementById('openAdminBtn');


// ボタン表示をサインイン状態で切り替え
function updateAdminButton(isSignedIn) {
  openAdminBtn.style.display = isSignedIn ? "block" : "none";
}

// モーダルを開く
async function openAdminNote() {
  adminNoteModal.style.display = 'flex';

  // Supabaseから最新メモを取得
  const { data, error } = await supabaseClient
    .from('notes')
    .select('*')
    .order('updated_at', { ascending:false })
    .limit(1)
    .single();

  if(data) {
    adminNoteTextarea.value = data.content;
  } else {
    adminNoteTextarea.value = '';
  }
}

// モーダルを閉じる
function closeAdminNote() {
  adminNoteModal.style.display = 'none';
}

// 保存ボタン
saveNoteBtn.addEventListener('click', async () => {
  const content = adminNoteTextarea.value;

  const { error } = await supabaseClient
    .from('notes')
    .upsert({ id: 1, content: content, updated_at: new Date() });

  if(error) {
    console.error(error);
    alert('保存失敗');
  } else {
    alert('保存しました');
  }
});

// 管理者メモを開くボタン
openAdminBtn.addEventListener('click', openAdminNote);

// --- ページロード時にサインイン状態をチェック ---
window.addEventListener("DOMContentLoaded", () => {
  const signedIn = localStorage.getItem("isSignedIn") === "true";
  updateAdminButton(signedIn);
});

// --- サインイン／サインアウト時にも表示制御を追加 ---
// サインイン後
function onSignIn() {
  isSignedIn = true;
  localStorage.setItem("isSignedIn", "true");
  updateAdminButton(isSignedIn);
}

// サインアウト後
function onSignOut() {
  isSignedIn = false;
  localStorage.removeItem("isSignedIn");
  updateAdminButton(isSignedIn);
  adminNoteModal.style.display = 'none'; // モーダルが開いていた場合は閉じる
       opensubeditmodal.style.display = "none";
}








const infoId = 1;

// --- 表示 ---
function renderVisitorCount(count, infoId) {
  const safeCount = (count !== undefined && count !== null) ? count : 0;
  const interval = setInterval(() => {
    const secElem = document.getElementById(`visitorCount-${infoId}`);
    if (secElem) {
      secElem.textContent = `閲覧者数: ${safeCount}`;
      clearInterval(interval); // 1回表示したら終了
    }
  }, 100);
}

// --- カウント ---
async function countVisitor() {
  const storageKey = `visited-${infoId}`;
  if (localStorage.getItem(storageKey)) {
    console.log('既にカウント済み');
    return;
  }

  const { data, error } = await supabaseClient
    .from('info')
    .select('visiters')
    .eq('id', infoId)
    .single();

  if (error) { console.error(error); return; }

  const newCount = (data.visiters || 0) + 1;

  const { error: updateErr } = await supabaseClient
    .from('info')
    .update({ visiters: newCount })
    .eq('id', infoId);

  if (updateErr) { console.error(updateErr); return; }

  localStorage.setItem(storageKey, 'true');
  renderVisitorCount(newCount, infoId);
}

// --- 初期表示 ---
window.addEventListener('DOMContentLoaded', async () => {
  // <div id="toukei"> を取得
  const toukeiDiv = document.getElementById("toukei");

  // サインイン状態なら表示
  if (typeof isSignedIn !== 'undefined' && isSignedIn) {
    toukeiDiv.style.display = "block";
  }

  // 現在の visiters を取得して表示
  const { data, error } = await supabaseClient
    .from('info')
    .select('visiters')
    .eq('id', infoId)
    .single();

  if (error) { 
    console.error(error); 
    renderVisitorCount(0, infoId);
  } else {
    renderVisitorCount(data.visiters || 0, infoId);
  }

  // カウント処理
  countVisitor();
});
function startHeroSlideshow() {
  const wrapper = document.querySelector(".hero .slides-wrapper");
  const slides = wrapper.children;
  const slideCount = slides.length;
  let index = 0;

  setInterval(() => {
    index = (index + 1) % slideCount;
    wrapper.style.transform = `translateX(-${100 * index}%)`;
  }, 2000);
}

window.addEventListener("DOMContentLoaded", startHeroSlideshow);







</script>
</body>
</html>
